var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},egret;!function(t){var e;!function(t){var e=function(){function t(){this.callbacks={}}return t.prototype.on=function(t,e,n){return this.$addListener(t,e,n),this},t.prototype.once=function(t,e,n){return this.$addListener(t,e,n,!0),this},t.prototype.off=function(t,e,n){return this.$removeListener(t,e,n),this},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.callbacks[t];if("undefined"!=typeof r&&null!==r){var o=[];for(r.forEach(function(t){(n=t.listion).call.apply(n,[t.listenerContext].concat(e)),t.dispatchOnce&&o.push(t);var n});o.length;){var i=o.pop();this.$removeListener(i.event,i.listener,i.listenerContext)}}},t.prototype.$addListener=function(t,e,n,r){var o=this.callbacks[t];o||(o=[],this.callbacks[t]=o);var i={listion:e,listenerContext:n,event:t,dispatchOnce:!!r};o.push(i)},t.prototype.$removeListener=function(t,e,n){if(!t)return void(this.callbacks=[]);var r=this.callbacks[t];r&&(this.$removeEventBin(r,e,n),0==r.length&&(this.callbacks[t]=null))},t.prototype.$removeEventBin=function(t,e,n){if(e&&n)for(var r=0;r<t.length;r++){var o=t[r];o.listener==e&&o.listenerContext==n&&t.splice(r,1)}else for(var r=0;r<t.length;r++)t.splice(r,1)},t}();t.Emitter=e,__reflect(e.prototype,"egret.socketio.Emitter")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(e){var n=function(n){function r(e){var r=n.call(this)||this;return r.readyState=t._emReadyState.CLOSED,r.writable=!0,r.opts=e.clone(),r}return __extends(r,n),r.prototype.onError=function(e){return this.emit(t._emEvent.EVENT_ERROR),this},r.prototype.open=function(){return(this.readyState===t._emReadyState.CLOSED||null===this.readyState)&&(this.readyState=t._emReadyState.OPENING,this.doOpen()),this},r.prototype.close=function(){return(this.readyState===t._emReadyState.OPENING||this.readyState===t._emReadyState.OPEN)&&(this.doClose(),this.onClose()),this},r.prototype.send=function(e){this.readyState===t._emReadyState.OPEN&&this.write(e)},r.prototype.onOpen=function(){this.readyState=t._emReadyState.OPEN,this.writable=!0,this.emit(t._emEvent.EVENT_OPEN)},r.prototype.onData=function(t){this.onPacket(e.Parser.decodePacket(t,!1))},r.prototype.onPacket=function(e){this.emit(t._emEvent.EVENT_PACKET,e)},r.prototype.onClose=function(){this.readyState=t._emReadyState.CLOSED,this.emit(t._emEvent.EVENT_CLOSE)},r}(t.Emitter);e.Transport=n,__reflect(n.prototype,"egret.socketio.engine.Transport")}(e=t.engine||(t.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t){return t&&(t=t.toString().replace(o.pluses,"%20"),t=decodeURIComponent(t)),t}function n(t){var e=o.uri_parser,n=["source","protocol","authority","userInfo","user","password","host","port","isColonUri","relative","path","directory","file","query","anchor"],r=e.exec(t||""),i={};return n.forEach(function(t,e){i[t]=r[e]||""}),i}function r(t){var n,r,i,s,a,c,p,u=[];if("undefined"==typeof t||null===t||""===t)return u;for(0===t.indexOf("?")&&(t=t.substring(1)),r=t.toString().split(o.query_separator),n=0,p=r.length;p>n;n++)i=r[n],s=i.indexOf("="),0!==s&&(a=e(i.substring(0,s)),c=e(i.substring(s+1)),u.push(-1===s?[i,null]:[a,c]));return u}var o={starts_with_slashes:/^\/+/,ends_with_slashes:/\/+$/,pluses:/\+/g,query_separator:/[&;]/,uri_parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@]*))?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)(?::(\d+|(?=:)))?(:)?)((((?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},i=function(){function t(t){this.uriParts=n(t),this.queryPairs=r(this.uriParts.query),this.hasAuthorityPrefixUserPref=null}return t.prototype.hasAuthorityPrefix=function(t){return"undefined"!=typeof t&&(this.hasAuthorityPrefixUserPref=t),null===this.hasAuthorityPrefixUserPref?-1!==this.uriParts.source.indexOf("//"):this.hasAuthorityPrefixUserPref},t.prototype.isColonUri=function(t){return"undefined"==typeof t?!!this.uriParts.isColonUri:void(this.uriParts.isColonUri=!!t)},t.prototype.query=function(t){var e,n,o,i="";for("undefined"!=typeof t&&(this.queryPairs=r(t)),e=0,o=this.queryPairs.length;o>e;e++)n=this.queryPairs[e],i.length>0&&(i+="&"),null===n[0]?i+=n[0]:(i+=n[0],i+="=","undefined"!=typeof n[1]&&(i+=encodeURIComponent(n[1])));return i.length>0?"?"+i:i},t.prototype.getQueryParamValue=function(t){var e,n,r;for(e=0,r=this.queryPairs.length;r>e;e++)if(n=this.queryPairs[e],t==n[0])return n[1]},t.prototype.getQueryParamValues=function(t){var e,n,r,o=[];for(e=0,r=this.queryPairs.length;r>e;e++)n=this.queryPairs[e],t==n[0]&&o.push(n[1]);return o},t.prototype.deleteQueryParam=function(t,n){var r,o,i,s,a,c=[];for(r=0,a=this.queryPairs.length;a>r;r++)o=this.queryPairs[r],i=e(o[0])===e(t),s=o[1]===n,(1!==arguments.length||i)&&(2!==arguments.length||i&&s)||c.push(o);return this.queryPairs=c,this},t.prototype.addQueryParam=function(t,e,n){return 3===arguments.length&&-1!==n?(n=Math.min(n,this.queryPairs.length),this.queryPairs.splice(n,0,[t,e])):arguments.length>0&&this.queryPairs.push([t,e]),this},t.prototype.hasQueryParam=function(t){var e,n=this.queryPairs.length;for(e=0;n>e;e++)if(this.queryPairs[e][0]==t)return!0;return!1},t.prototype.replaceQueryParam=function(t,n,r){var o,i,s=-1,a=this.queryPairs.length;if(3===arguments.length){for(o=0;a>o;o++)if(i=this.queryPairs[o],e(i[0].toString())===e(t)&&decodeURIComponent(i[1])===e(r.toString())){s=o;break}s>=0&&this.deleteQueryParam(t,e(r.toString())).addQueryParam(t,n,s)}else{for(o=0;a>o;o++)if(i=this.queryPairs[o],e(i[0].toString())===e(t)){s=o;break}this.deleteQueryParam(t),this.addQueryParam(t,n,s)}return this},t.prototype.scheme=function(){var t="";return this.protocol?(t+=this.protocol,this.protocol.indexOf(":")!==this.protocol.length-1&&(t+=":"),t+="//"):this.hasAuthorityPrefix()&&this.host&&(t+="//"),t},t.prototype.origin=function(){var t=this.scheme();return this.userInfo&&this.host&&(t+=this.userInfo,this.userInfo.indexOf("@")!==this.userInfo.length-1&&(t+="@")),this.host&&(t+=this.host,(this.port||this.path.substr(0,1).match(/[0-9]/))&&(t+=":"+this.port)),t},t.prototype.addTrailingSlash=function(){var t=this.path||"";return"/"!==t.substr(-1)&&(this.path=t+"/"),this},t.prototype.toString=function(){var t,e=this.origin();return this.isColonUri()?this.path&&(e+=":"+this.path):this.path?(t=this.path,o.ends_with_slashes.test(e)||o.starts_with_slashes.test(t)?(e&&e.replace(o.ends_with_slashes,"/"),t=t.replace(o.starts_with_slashes,"/")):e+="/",e+=t):this.host&&(this.query.toString()||this.anchor)&&(e+="/"),this.query().toString()&&(e+=this.query().toString()),this.anchor&&(0!==this.anchor.indexOf("#")&&(e+="#"),e+=this.anchor),e},t.prototype.clone=function(){return new t(this.toString())},Object.defineProperty(t.prototype,"protocol",{get:function(){return this.uriParts.protocol},set:function(t){this.uriParts.protocol=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userInfo",{get:function(){return this.uriParts.userInfo},set:function(t){this.uriParts.userInfo=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this.uriParts.host},set:function(t){this.uriParts.host=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this.uriParts.port},set:function(t){this.uriParts.port=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.uriParts.path},set:function(t){this.uriParts.path=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this.uriParts.anchor},set:function(t){this.uriParts.anchor=t},enumerable:!0,configurable:!0}),t}();t.Uri=i,__reflect(i.prototype,"egret.socketio.Uri")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var n;!function(n){var r=function(r){function o(n){var i=r.call(this,n)||this;return i._writeMessage="",i._readMessage="",i.pause=function(t){i.readyState=e._emReadyState.PAUSING;var n=function(){i.readyState=e._emReadyState.PAUSED,t()};if(i.polling||!i.writable){var r=0;i.polling&&(r++,i.once(e._emEvent.EVENT_POLL_COMPLETE,function(){--r||n()})),i.writable||(r++,i.once(e._emEvent.EVENT_DRAIN,function(){--r||n()}))}else n()},i.name=o.NAME,i._readByte=new t.ByteArray,i._writeByte=new t.ByteArray,i}return __extends(o,r),o.prototype.onData=function(t){var e;"string"==typeof t?e=t:(this._readByte.position=0,this._readByte._writeUint8Array(new Uint8Array(t)),e=this._readByte.readUTF(),this._readByte.clear()),this._onData(e)},o.prototype._onData=function(t){var r=this,o=function(t,o,i){return r.readyState===e._emReadyState.OPENING&&r.onOpen(),t.type===n._emPacketType[n._emPacketType.close]?(r.onClose(),!1):(r.onPacket(t),!0)};n.Parser.decodePayload(t,o),this.readyState!=e._emReadyState.CLOSED&&(this.polling=!1,this.emit(e._emEvent.EVENT_POLL_COMPLETE),this.readyState===e._emReadyState.OPEN?this.poll():console.debug("ignoring poll - transport state "+e._emReadyState[this.readyState]))},o.prototype.write=function(t){var r=this;this.writable=!1;var o=function(){r.writable=!0,r.emit(e._emEvent.EVENT_DRAIN)};n.Parser.encodePayload(t,function(t){r.doWrite(t,o)})},o.prototype.doOpen=function(){this.poll()},o.prototype.doClose=function(){},o.prototype.poll=function(){console.debug("polling"),this.polling=!0,this.doPoll(),this.emit(e._emEvent.EVENT_POLL)},o.prototype.uri=function(){var t=this.opts.clone();t.addTrailingSlash(),t.addQueryParam("b64",1);var e=t.secure?"https":"http";return t.protocol=e,t.timestampRequests&&t.addQueryParam(t.timestampParam,n.Yeast.yeast()),t.toString()},o.NAME="polling",o}(n.Transport);n.Polling=r,__reflect(r.prototype,"egret.socketio.engine.Polling")}(n=e.engine||(e.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var n=function(n){function r(t,r){var o=n.call(this)||this;return o.nsps={},o.subs=[],o.connecting=[],o.packetBuffer=[],r=r||{timeout:2e4,reconnection:!0},t.path=r.path||"/socket.io",r.reconnection=r.reconnection||!0,o.opts=r,o.reconnection(r.reconnection),o.reconnectionAttempts(r.reconnectionAttempts||1/0),o.reconnectionDelay(r.reconnectionDelay||1e3),o.reconnectionDelayMax(r.reconnectionDelayMax||5e3),o.randomizationFactor(r.randomizationFactor||.5),o.timeout(r.timeout||2e4),o.backoff=new e.Backoff({min:o.reconnectionDelay(),max:o.reconnectionDelayMax(),jitter:o.randomizationFactor()}),o.readyState=e._emReadyState.CLOSED,o.connecting=[],o.lastPing=null,o.encoding=!1,o.uri=t,o.encoder=r.parser&&r.parser.Encoder||new e.parser.Encoder,o.decoder=r.parser&&r.parser.Decoder||new e.parser.Decoder,o.autoConnect=r.autoConnect!==!1,o}return __extends(r,n),r.prototype.emitAll=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.emit(t,e);for(var r in this.nsps)this.nsps[r].emit(t,e)},r.prototype.updateSocketIds=function(){for(var t in this.nsps)this.nsps[t].id=this.generateId(t)},r.prototype.generateId=function(t){return"/"===t?"":t+"#"+this.engine.id},r.prototype.reconnection=function(t){return t?(this._reconnection=t,this):this._reconnection},r.prototype.reconnectionAttempts=function(t){return t?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(t){return t?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(t){return t?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(t){return t?(this._reconnectionDelayMax,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},r.prototype.timeout=function(t){return t?(this._timeout=t,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=function(n,r){var o=this;if(this.readyState===e._emReadyState.OPEN)return this;var i=new e.engine.SocketUri(this.uri.toString());i.transports=this.opts.transports,this.engine=new e.engine.Socket(i);var s=this.engine;this.readyState=e._emReadyState.OPENING,this.skipReconnect=!1;var a=e.on(s,e._emEvent.EVENT_OPEN,function(){o.onopen(),n&&n()}),c=e.on(s,e._emEvent.EVENT_ERROR,function(t){if(o.cleanup(),o.readyState=e._emReadyState.CLOSED,o.emitAll(e._emEvent.EVENT_CONNECT_ERROR,t),n){var r=new Error("Connection error");r.data=t,n(r)}else o.maybeReconnectOnOpen()});if(this._timeout){var p=this._timeout,u=t.setTimeout(function(){a.destory(),s.close(),s.emit(e._emEvent.EVENT_ERROR,"timeout"),o.emitAll(e._emEvent.EVENT_CONNECT_ERROR,p)},this,p);this.subs.push({destory:function(){t.clearTimeout(u)}})}return this.subs.push(a),this.subs.push(c),this},r.prototype.onopen=function(){console.debug("open"),this.cleanup(),this.readyState=e._emReadyState.OPEN,this.emit(e._emEvent.EVENT_OPEN);var t=this.engine;this.subs.push(e.on(t,e._emEvent.EVENT_DATA,this.ondata,this)),this.subs.push(e.on(t,e._emEvent.EVENT_PING,this.onping,this)),this.subs.push(e.on(t,e._emEvent.EVENT_PONG,this.onpong,this)),this.subs.push(e.on(t,e._emEvent.EVENT_ERROR,this.onerror,this)),this.subs.push(e.on(t,e._emEvent.EVENT_CLOSE,this.onclose,this)),this.subs.push(e.on(this.decoder,e._emEvent.EVENT_DECODED,this.ondecoded,this))},r.prototype.cleanup=function(){for(var t=this.subs.length,e=0;t>e;e++){var n=this.subs.shift();n.destory&&n.destory()}this.encoding=!1,this.lastPing=null,this.decoder.destory()},r.prototype.socket=function(t,n){var r=this,o=this.nsps[t];if(!o){var i=function(){r.connecting.indexOf(o)||r.connecting.push(o)};o=new e.Socket(this,t,this.uri),this.nsps[t]=o,o.on(e._emEvent.EVENT_CONNECTING,i),o.on(e._emEvent.EVENT_CONNECT,function(){o.id=r.generateId(t)}),this.autoConnect&&i()}return o},r.prototype.packet=function(t){var e=this;console.debug("writing packet",t),t.query&&0===t.type&&(t.nsp+="?"+t.query),this.encoding?this.packetBuffer.push(t):(this.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},r.prototype.reconnect=function(){var n=this;if(this.reconnecting||this.skipReconnect)return this;if(this.backoff.attempts>=this._reconnectionAttempts)console.debug("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var r=this.backoff.duration();console.debug("will wait "+r+"dms before reconnect attempt"),this.reconnecting=!0;var o=t.setTimeout(function(){n.skipReconnect||(n.emitAll(e._emEvent.EVENT_RECONNECT_ATTEMPT,n.backoff.attempts),n.emitAll(e._emEvent.EVENT_RECONNECTING,n.backoff.attempts),n.skipReconnect||n.open(function(t){t?(console.debug("reconnect attempt error"),n.reconnecting=!1,n.reconnect(),n.emitAll(e._emEvent.EVENT_RECONNECT_ERROR,t.data)):(console.debug("reconnect success"),n.onreconnect())}))},this,r);this.subs.push({destory:function(){t.clearTimeout(o)}})}},r.prototype.destroy=function(t){var e=this.connecting.indexOf(t);e>0&&this.connecting.splice(e,1),this.connecting.length||this.close()},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},r.prototype.close=function(){return this.disconnect()},r.prototype.disconnect=function(){console.debug("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,this.readyState===e._emReadyState.OPENING&&this.cleanup(),this.backoff.reset(),this.readyState=e._emReadyState.CLOSED,this.engine&&this.engine.close()},r.prototype.ondata=function(t){this.decoder.add(t)},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll(e._emEvent.EVENT_PING)},r.prototype.onpong=function(){this.emitAll(e._emEvent.EVENT_PONG,(new Date).getDate()-this.lastPing.getDate())},r.prototype.onerror=function(t){console.error(e._emEvent.EVENT_ERROR,t),this.emitAll(e._emEvent.EVENT_ERROR,t)},r.prototype.onclose=function(t){console.debug("onclose"),this.cleanup(),this.backoff.reset(),this.readyState=e._emReadyState.CLOSED,this.emit(e._emEvent.EVENT_CLOSE,t),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.ondecoded=function(t){this.emit(e._emEvent.EVENT_PACKET,t)},r.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll(e._emEvent.EVENT_RECONNECT,t)},r}(e.Emitter);e.Manager=n,__reflect(n.prototype,"egret.socketio.Manager")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t,e,n,r){return t.on(e,n,r),{destory:function(){t.off(e,n,r)}}}t.on=e}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.ERROR=4]="ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(e=t._emParser||(t._emParser={}));var n;!function(n){var r=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.encode=function(t,n){if(t.type===e.BINARY_EVENT||t.type===e.BINARY_ACK)this.encodeAsBinary(t,n);else{var r=this.encodeAsString(t);n([r])}},n.prototype.encodeAsString=function(t){var r=""+t.type;if((e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)&&(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),t.id&&(r+=t.id),t.data){var o=this.tryStringify(t.data);if(o===!1)return n.ERROR_PACKET;r+=o}return r},n.prototype.tryStringify=function(t){try{return JSON.stringify(t)}catch(e){return!1}},n.prototype.encodeAsBinary=function(t,e){},n.ERROR_PACKET=e.ERROR+'"encode error"',n}(t.Emitter);__reflect(r.prototype,"EncoderImpl",["egret.socketio.parser.Encoder"]);var o=function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.reconstructor=null,t}return __extends(r,n),r.prototype.add=function(n){var r;"string"==typeof n&&(r=this.decodeString(n),e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type?this.reconstructor=new t.BinaryReconstructor(r):this.emit(t._emEvent.EVENT_DECODED,r))},r.prototype.decodeString=function(n){var r=0,o={type:Number(n.charAt(0))};if(!e[o.type])return this.error("unknown packet type "+o.type);if(o.type===e.BINARY_EVENT||o.type===e.BINARY_ACK){for(var i="";"-"!==n.charAt(++r)&&(i+=n.charAt(r),r!=n.length););if(i!=Number(i).toString()||"-"!==n.charAt(r))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===n.charAt(r+1))for(o.nsp="";++r;){var s=n.charAt(r);if(","===s)break;if(o.nsp+=s,r===n.length)break}else o.nsp="/";var a=n.charAt(r+1);if(""!==a&&Number(a).toString()==a){for(var c="";++r;){var s=n.charAt(r);if(null==s||Number(s).toString()!=s){--r;break}if(c+=n.charAt(r),r===n.length)break}o.id=Number(c)}if(n.charAt(++r)){var p=this.tryParse(n.substr(r)),u=p!==!1&&(o.type===e.ERROR||t.isArray(p));if(!u)return this.error("invalid payload");o.data=p}return o},r.prototype.tryParse=function(t){try{return JSON.parse(t)}catch(e){return!1}},r.prototype.error=function(t){return{type:e.ERROR,data:"parser error: "+t}},r.prototype.destory=function(){},r.prototype.onDecoded=function(t){},r}(t.Emitter);__reflect(o.prototype,"DecoderImpl",["egret.socketio.parser.Decoder"]),n.Encoder=r,n.Decoder=o}(n=t.parser||(t.parser={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},n=function(n){function r(t,e,r){var o=n.call(this)||this;return o.receiveBuffer=[],o.sendBuffer=[],o.acks={},o.io=t,o.nsp=e,o.ids=0,o.connected=!1,o.disconnected=!0,o.flags={},o.uri=r,o.io.autoConnect&&o.open(),o}return __extends(r,n),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[t.on(e,t._emEvent.EVENT_OPEN,this.onopen,this),t.on(e,t._emEvent.EVENT_PACKET,this.onpacket,this),t.on(e,t._emEvent.EVENT_CLOSE,this.onclose,this)]}},r.prototype.open=function(){var e=this;return new Promise(function(n){e.connected||(e.subEvents(),e.io.open(),e.io.readyState===t._emReadyState.OPEN&&e.onopen(),e.emit(t._emEvent.EVENT_CONNECTING))}),this},r.prototype.send=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.unshift(t._emEvent.EVENT_MESSAGE),this.emit.apply(this,e),this},r.prototype.emit=function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];if(e.hasOwnProperty(r))return n.prototype.emit.call(this,r,o),this;o.unshift(r);var s=t.toArray(o),a={type:t._emParser.EVENT,data:s};return a.options={},a.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof s[s.length-1]&&(console.debug("emitting packet with ack id "+this.ids),this.acks[this.ids]=s.pop(),a.id=this.ids++),this.connected?this.packet(a):this.sendBuffer.push(a),this},r.prototype.connnect=function(){return this.open()},r.prototype.close=function(){return this.disconnect()},r.prototype.disconnect=function(){return this.connected&&(console.debug("performing disconnect "+this.nsp),this.packet({type:t._emParser.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},r.prototype.ack=function(e){var n=this,r=!1;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];if(!r){r=!0;var s=t.toArray(o);n.packet({type:t._emParser.ACK,id:e,data:s})}}},r.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destory();this.subs=null}this.io.destroy(this)},r.prototype.emitBuffered=function(){for(var t in this.receiveBuffer)n.prototype.emit.apply(this,this.receiveBuffer[t]);this.receiveBuffer=[];for(var t in this.sendBuffer)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},r.prototype.onopen=function(){console.debug("transport is open - connecting"),"/"!==this.nsp&&(this.uri.query()?this.packet({type:t._emParser.CONNECT,query:this.uri.query()}):this.packet({type:t._emParser.CONNECT}))},r.prototype.onpacket=function(e){var n=e.nsp===this.nsp,r=e.type===t._emParser.ERROR&&"/"===e.nsp;if(n||r)switch(e.type){case t._emParser.CONNECT:this.onconnect();break;case t._emParser.EVENT:this.onevent(e);break;case t._emParser.BINARY_EVENT:this.onevent(e);break;case t._emParser.ACK:this.onack(e);break;case t._emParser.BINARY_ACK:this.onack(e);break;case t._emParser.DISCONNECT:this.ondisconnect();break;case t._emParser.ERROR:this.emit(t._emEvent.EVENT_ERROR,e.data)}},r.prototype.onconnect=function(){this.connected=!0,this.emit(t._emEvent.EVENT_CONNECT),this.emitBuffered()},r.prototype.onevent=function(t){var e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?n.prototype.emit.apply(this,e):this.receiveBuffer.push(e)},r.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(e.apply(this,t.data),delete this.acks[t.id]):console.warn("bad ack "+t.id)},r.prototype.ondisconnect=function(){console.debug("server disconnect "+this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.onclose=function(e){console.debug("close"),this.connected=!1,this.disconnected=!0,delete this.id,this.emit(t._emEvent.EVENT_DISCONNECT,e)},r}(t.Emitter);t.Socket=n,__reflect(n.prototype,"egret.socketio.Socket")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(t){this.ms=100,this.max=1e4,this.factor=2,this.attempts=0,t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.factor=t.factor||2,this.attempts=0}return t.prototype.setMin=function(t){return this.ms=t,this},t.prototype.setMax=function(t){return this.max=t,this},t.prototype.setJitter=function(t){return this.jitter=t,this},t.prototype.setFactor=function(t){return this.factor=t,this},t.prototype.reset=function(){this.attempts=0},t.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},t}();t.Backoff=e,__reflect(e.prototype,"egret.socketio.Backoff")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(t){this.buffers=[],this.reconPack=t}return t.prototype.takeBinaryData=function(t){return null},t.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]},t}();t.BinaryReconstructor=e,__reflect(e.prototype,"egret.socketio.BinaryReconstructor")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function e(){this._cache={}}return e.prototype.socket=function(e,n){var r="string"==typeof e?e:e.toString();n=n||{};var o=new t.Uri(r);o.addTrailingSlash();var i,s=t.Url.extractId(r),a=o.path,c=this._cache[s]&&a in this._cache[s].nsps,p=n.forceNew||n["force new connection"]||!1===n.multiplex||c;return p?i=new t.Manager(o,n):(this._cache[s]||(this._cache[s]=new t.Manager(o,n)),i=this._cache[s]),i.socket(a,n)},e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e}();__reflect(e.prototype,"IO"),t.SocketIOClientStatic=function(t,n){return e.getInstance().socket(t,n)},t.SocketIOClientStatic.prototype.connect=function(t,n){return e.getInstance().socket(t,n)},t.io=t.SocketIOClientStatic}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function e(n){"string"==typeof n&&(n=new t.Uri(n)),this.uri=n,this.protocol=n.protocol;var r=n.path;("undefined"==typeof r||0==r.length)&&(r="/"),this.path=r,this.host=n.host;var o=n.port;"undefined"==typeof o&&(o=e.PATTERN_HTTP.test(this.protocol)?80:443)}return e.prototype.toString=function(){var t;(null===this.protocol||this.protocol.match(/^https?|wss?$/g))&&(t="https");var n=this.path;("undefined"==typeof n||0==n.length)&&(n="/"),null!==this.uri.userInfo&&(t+=this.uri.userInfo+"@"),t+=this.uri.host;var r=this.port;return"undefined"==typeof r&&(r=e.PATTERN_HTTP.test(this.protocol)?80:443),t+=":"+r.toString(),t+=n,this.uri.query&&(t+="?"+this.uri.query),this.uri.anchor&&(0!==this.uri.anchor.indexOf("#")&&(t+="#"),t+=this.uri.anchor),t},e.parse=function(t){return new e(t)},e.extractId=function(e){"string"==typeof e&&(e=new t.Uri(e));var n=e.protocol,r=e.port;return r||(this.PATTERN_HTTP.test(n)?r=80:this.PATTERN_HTTPS.test(n)&&(r=443)),n+"://"+e.host+":"+r.toString()},e.secure=function(e){return"string"==typeof e&&(e=new t.Uri(e)),this.PATTERN_HTTPS.test(e.protocol)},e.PATTERN_HTTP=/^http|ws$/,e.PATTERN_HTTPS=/^(http|ws)s$/,e}();t.Url=e,__reflect(e.prototype,"egret.socketio.Url")}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(e){var n;!function(t){t[t.open=0]="open",t[t.close=1]="close",t[t.ping=2]="ping",t[t.pong=3]="pong",t[t.message=4]="message",t[t.upgrade=5]="upgrade",t[t.noop=6]="noop",t[t.error=7]="error"}(n=e._emPacketType||(e._emPacketType={}));var r=function(t){function e(e){var n=t.call(this,e)||this;n.secure=/^(http|ws)s$/.test(n.protocol),n.timestampParam="t";var r=n.host;if(n.ipv6){var o=r.indexOf("[");-1!=o&&(r=r.substring(o+1));var i=r.lastIndexOf("]");-1!=i&&(r=r.substring(0,i))}return n.hostname=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"ipv6",{get:function(){return this.host.split(":").length>2},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.toString())},e}(t.Uri);e.TransportUri=r,__reflect(r.prototype,"egret.socketio.engine.TransportUri");var o=function(t){function e(e){var n=t.call(this,e)||this;return n.upgrade=!0,n.transportOptions={},n}return __extends(e,t),e.prototype.clone=function(){return new e(this.toString())},e}(r);e.SocketUri=o,__reflect(o.prototype,"egret.socketio.engine.SocketUri")}(e=t.engine||(t.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){var e={type:"error",data:"parser error"},n=function(){function n(){}return n.decodePacket=function(n,r){if(void 0===n)return e;if(r)return e;var o=Number(n.charAt(0));return t._emPacketType[o]?n.length>1?{type:t._emPacketType[o],data:n.substring(1)}:{type:t._emPacketType[o]}:e},n.decodePayload=function(t,n){if(!t||0===t.length)return n(e,0,1);for(var r,o,i="",s=0,a=t.length;a>s;s++){var c=t.charAt(s);if(":"==c){if(""===i||i!=(r=Number(i)).toString())return n(e,0,1);if(o=t.substr(s+1,r),r!=o.length)return n(e,0,1);if(o.length){var p=this.decodePacket(o,!1);if(e.type===p.type&&e.data===p.data)return n(e,0,1);var u=n(p,s+r,a);if(!1===u)return}s+=r,i=""}else i+=c}return""!=i?n(e,0,1):void 0},n.encodePacket=function(e,n,r){var o=t._emPacketType[e.type].toString();e.data&&(o+=e.data),r(o)},n.encodePayload=function(t,e){var n=this;if(0===t.length)return e("0:");var r="";for(var o in t)this.encodePacket(t[o],!1,function(t){r+=n.setLengthHeader(t)});e(r)},n.setLengthHeader=function(t){return t.length.toString()+":"+t},n}();t.Parser=n,__reflect(n.prototype,"egret.socketio.engine.Parser")}(e=t.engine||(t.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t,e){var n=[];e=e||0;for(var r=e||0;r<t.length;r++)n[r-e]=t[r];return n}function n(t){return"[object Array]"=={}.toString.call(t)}var r;!function(t){t[t.OPENING=0]="OPENING",t[t.OPEN=1]="OPEN",t[t.CLOSING=2]="CLOSING",t[t.CLOSED=3]="CLOSED",t[t.PAUSING=4]="PAUSING",t[t.PAUSED=5]="PAUSED"}(r=t._emReadyState||(t._emReadyState={}));var o;!function(t){t.EVENT_OPEN="open",t.EVENT_CLOSE="close",t.EVENT_PACKET="packet",t.EVENT_MESSAGE="message",t.EVENT_ERROR="error",t.EVENT_UPGRADE_ERROR="upgradeError",t.EVENT_FLUSH="flush",t.EVENT_DRAIN="drain",t.EVENT_HANDSHAKE="handshake",t.EVENT_UPGRADING="upgrading",t.EVENT_UPGRADE="upgrade",t.EVENT_PACKET_CREATE="packetCreate",t.EVENT_HEARTBEAT="heartbeat",t.EVENT_DATA="data",t.EVENT_CONNECT="connect",t.EVENT_CONNECTING="connecting",t.EVENT_CONNECT_ERROR="connect_error",t.EVENT_CONNECT_TIMEOUT="connect_timeout",t.EVENT_DISCONNECT="disconnect",t.EVENT_RECONNECT="reconnect",t.EVENT_RECONNECT_ERROR="reconnect_error",t.EVENT_RECONNECT_FAILED="reconnect_failed",t.EVENT_RECONNECT_ATTEMPT="reconnect_attempt",t.EVENT_RECONNECTING="reconnecting",t.EVENT_PING="ping",t.EVENT_PONG="pong",t.EVENT_TRANSPORT="transport",t.EVENT_REQUEST_HEADERS="requestHeaders",t.EVENT_RESPONSE_HEADERS="responseHeaders",t.EVENT_POLL="poll",t.EVENT_POLL_COMPLETE="pollComplete",t.EVENT_DECODED="decoded"}(o=t._emEvent||(t._emEvent={})),t.toArray=e,t.isArray=n}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var n;!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.request=function(e){e=e||{method:"GET"};var n=new t.HttpRequest;return n.open(this.uri(),e.method),n.response,n},n.prototype.doPoll=function(){var e=this;console.debug("xhr poll");var n=this.request();n.addEventListener(t.Event.COMPLETE,function(){var t=n.response;e.onData(t)},this),n.addEventListener(t.IOErrorEvent.IO_ERROR,function(){e.onError("xhr poll error")},this),n.responseType=t.HttpResponseType.TEXT,n.send()},n.prototype.doWrite=function(e,n){var r=this,o={};o.method="POST",o.data=e;var i=this.request(o);i.addEventListener(t.Event.COMPLETE,function(){n()},this),i.addEventListener(t.IOErrorEvent.IO_ERROR,function(){r.onError("xhr post error")},this),i.send(o.data)},n}(e.Polling);e.PollingXHR=n,__reflect(n.prototype,"egret.socketio.engine.PollingXHR")}(n=e.engine||(e.engine={}))
}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var n;!function(n){var r=function(r){function o(t){var o=r.call(this)||this;return o.id=null,o.upgrades=null,o.upgrading=!1,o.pingInterval=null,o.pingTimeout=null,o.pingIntervalTimer=null,o.pingTimeoutTimer=null,o.writeBuffer=[],o.prevBufferLen=0,"string"==typeof t&&(t=new n.SocketUri(t)),o.readyState=e._emReadyState.CLOSED,o.opts=t.clone(),t.port||(o.opts.port=t.secure?443:80),o.opts.transports=t.transports||[n.Polling.NAME,n.WebSocket.NAME],o.open(),o}return __extends(o,r),o.prototype.open=function(){var t=this;return new Promise(function(r,i){var s;if(t.opts.rememberUpgrade&&o.priorWebsocketSuccess&&-1!==t.opts.transports.indexOf(n.WebSocket.NAME))s=n.WebSocket.NAME;else{if(0===t.opts.transports.length)return void t.emit(e._emEvent.EVENT_ERROR,"No transports available");s=t.opts.transports[0]}t.readyState=e._emReadyState.OPENING;var a=t.createTransport(s);t.setTransport(a),a.open()}),this},o.prototype.flush=function(){this.readyState!==e._emReadyState.CLOSED&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit(e._emEvent.EVENT_FLUSH))},o.prototype.probe=function(t){var r=this,i=this.createTransport(t,{probe:1}),s=!1;o.priorWebsocketSuccess=!1;var a=function(){s||(i.send([{type:n._emPacketType[n._emPacketType.ping],data:"probe"}]),i.once(e._emEvent.EVENT_PACKET,function(t){if(!s)if(n._emPacketType[t.type]===n._emPacketType.pong&&"probe"===t.data){if(r.upgrading=!0,r.emit(e._emEvent.EVENT_UPGRADING,i),!i)return;o.priorWebsocketSuccess=n.WebSocket.NAME===i.name,r.transport.pause(function(){s||r.readyState!==e._emReadyState.CLOSED&&(f(),r.setTransport(i),i.send([{type:n._emPacketType[n._emPacketType.upgrade]}]),r.emit(e._emEvent.EVENT_UPGRADE,i),i=null,r.upgrading=!1,r.flush())})}else{var a=new Error("probe error");a.transport=i.name,r.emit(e._emEvent.EVENT_UPGRADE_ERROR,a)}}))},c=function(){s||(s=!0,f(),i&&i.close(),i=null)},p=function(t){var n=new Error("probe error: "+t);n.transport=i&&i.name,c(),r.emit(e._emEvent.EVENT_UPGRADE_ERROR,n)},u=function(){p("socket closed")},h=function(t){i&&t.name!=i.name&&c()},f=function(){i&&i.off(e._emEvent.EVENT_OPEN,a),i&&i.off(e._emEvent.EVENT_ERROR,p),i&&i.off(e._emEvent.EVENT_CLOSE,u),r.off(e._emEvent.EVENT_CLOSE,u),r.off(e._emEvent.EVENT_UPGRADING,h)};i.once(e._emEvent.EVENT_OPEN,a),i.once(e._emEvent.EVENT_ERROR,p),i.once(e._emEvent.EVENT_CLOSE,u),this.once(e._emEvent.EVENT_CLOSE,u),this.once(e._emEvent.EVENT_UPGRADING,h),i.open()},o.prototype.ping=function(){var t=this;this.sendPacket(n._emPacketType[n._emPacketType.ping],function(){t.emit(e._emEvent.EVENT_PING)})},o.prototype.createTransport=function(t,r){var o=this.opts.transportOptions[t],i=new n.TransportUri(this.opts.toString());i.addQueryParam("EIO",3),i.addQueryParam("transport",t),this.id&&i.addQueryParam("sid",this.id),i.hostname=o&&o.hostname||this.opts.hostname,i.port=o&&o.port||this.opts.port,i.secure=o&&o.secure||this.opts.secure,i.path=o&&o.path||this.opts.path,i.timestampRequests=o&&o.timestampRequests||this.opts.timestampRequests,i.timestampParam=o&&o.timestampParam||this.opts.timestampParam,i.policyPort=o&&o.policyPort||this.opts.policyPort;var s;if(n.WebSocket.NAME===t)s=new n.WebSocket(i);else{if(n.Polling.NAME!==t)return null;s=new n.PollingXHR(i)}return this.emit(e._emEvent.EVENT_TRANSPORT,s),s},o.prototype.setTransport=function(t){this.transport&&this.transport.off(),this.transport=t,t.on(e._emEvent.EVENT_DRAIN,this.onDrain,this).on(e._emEvent.EVENT_PACKET,this.onPacket,this).on(e._emEvent.EVENT_ERROR,this.onError,this).on(e._emEvent.EVENT_CLOSE,this.onClose,this)},o.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},o.prototype.onPacket=function(t){if(this.readyState===e._emReadyState.OPENING||this.readyState===e._emReadyState.OPEN||this.readyState===e._emReadyState.CLOSING)switch(this.emit(e._emEvent.EVENT_PACKET,t),this.emit(e._emEvent.EVENT_HEARTBEAT),n._emPacketType[t.type]){case n._emPacketType.open:this.onHandshake(JSON.parse(t.data));break;case n._emPacketType.pong:this.setPing(),this.emit(e._emEvent.EVENT_PONG);break;case n._emPacketType.error:var r=new Error("server error");r.code=t.data,this.onError(r);break;case n._emPacketType.message:this.emit(e._emEvent.EVENT_DATA,t.data),this.emit(e._emEvent.EVENT_MESSAGE,t.data)}else console.log("packet received with socket readyState "+this.readyState)},o.prototype.onError=function(t){console.debug("socket error "+t),o.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},o.prototype.onOpen=function(){if(console.debug("socket open"),this.readyState=e._emReadyState.OPEN,o.priorWebsocketSuccess=this.transport.name===n.WebSocket.NAME,this.emit(e._emEvent.EVENT_OPEN),this.flush(),this.readyState===e._emReadyState.OPEN&&this.upgrades&&this.transport.pause){console.debug("starting upgrade probes");for(var t=0,r=this.upgrades.length;r>t;t++)this.probe(this.upgrades[t])}},o.prototype.onClose=function(n,r){(this.readyState===e._emReadyState.OPENING||this.readyState===e._emReadyState.OPEN||this.readyState===e._emReadyState.CLOSING)&&(console.debug("socket close with reason: "+n),t.clearTimeout(this.pingIntervalTimer),t.clearTimeout(this.pingTimeoutTimer),this.transport.off(e._emEvent.EVENT_CLOSE),this.transport.close(),this.transport.off(),this.readyState=e._emReadyState.CLOSED,this.id=null,this.emit(e._emEvent.EVENT_CLOSE,n,r))},o.prototype.close=function(){var t=this,n=function(){t.onClose("forced close"),console.debug("socket closing - telling transport to close"),t.transport.close()},r=function(){t.off(e._emEvent.EVENT_UPGRADE,r),t.off(e._emEvent.EVENT_UPGRADE_ERROR,r)},o=function(){t.once(e._emEvent.EVENT_UPGRADE,r),t.once(e._emEvent.EVENT_UPGRADE_ERROR,r)};return(this.readyState===e._emReadyState.OPENING||this.readyState===e._emReadyState.OPEN)&&(this.readyState=e._emReadyState.CLOSING,this.writeBuffer.length?this.once(e._emEvent.EVENT_DRAIN,function(){t.upgrading?o():n()}):this.upgrading?o():n()),this},o.prototype.onHandshake=function(t){this.emit(e._emEvent.EVENT_HANDSHAKE,t),this.id=t.sid,this.transport.opts.replaceQueryParam("sid",t.sid),this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.readyState!==e._emReadyState.CLOSED&&(this.setPing(),this.off(e._emEvent.EVENT_HEARTBEAT,this.onHeartbeat,this),this.on(e._emEvent.EVENT_HEARTBEAT,this.onHeartbeat,this))},o.prototype.setPing=function(){var e=this;t.clearTimeout(this.pingIntervalTimer),this.pingIntervalTimer=t.setTimeout(function(){console.debug("writing ping packet - expecting pong within "+e.pingTimeout+"ms"),e.ping(),e.onHeartbeat(e.pingTimeout)},this,this.pingInterval)},o.prototype.onHeartbeat=function(n){var r=this;t.clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=t.setTimeout(function(){r.readyState!==e._emReadyState.CLOSED&&r.onClose("ping timeout")},this,n||this.pingInterval+this.pingTimeout)},o.prototype.write=function(t,e,n){return this.send(t,e,n)},o.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},o.prototype.sendPacket=function(t,n,r,o){if("function"==typeof n&&(o=n,n=void 0),"function"==typeof r&&(o=r,r=null),this.readyState!==e._emReadyState.CLOSING&&this.readyState!==e._emReadyState.CLOSED){r=r||{};var i={type:t,data:n,options:r};this.emit(e._emEvent.EVENT_PACKET_CREATE,i),this.writeBuffer.push(i),o&&this.once(e._emEvent.EVENT_FLUSH,o),this.flush()}},o.prototype.filterUpgrades=function(t){for(var e=[],n=0;n<t.length;n++)this.opts.transports.indexOf(t[n])&&e.push(t[n]);return e},o.priorWebsocketSuccess=!1,o}(e.Emitter);n.Socket=r,__reflect(r.prototype,"egret.socketio.engine.Socket")}(n=e.engine||(e.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var n;!function(n){var r=function(r){function o(t){var e=r.call(this,t)||this;return e.name=o.NAME,e}return __extends(o,r),o.prototype.addEventListeners=function(){this.ws.addEventListener(t.ProgressEvent.SOCKET_DATA,this.onWsData,this),this.ws.addEventListener(t.Event.CONNECT,this.onWsOpen,this),this.ws.addEventListener(t.Event.CLOSE,this.onWsClose,this),this.ws.addEventListener(t.IOErrorEvent.IO_ERROR,this.onWsError,this)},o.prototype.write=function(t){var r=this;this.writable=!1;for(var o=t.length,i=function(){new Promise(function(t,n){r.ws.flush(),r.emit(e._emEvent.EVENT_FLUSH),t(1)}).then(function(){r.writable=!0,r.emit(e._emEvent.EVENT_DRAIN)})},s=0;o>s&&(this.readyState===e._emReadyState.OPENING||this.readyState===e._emReadyState.OPEN);s++)n.Parser.encodePacket(t[s],!1,function(t){r.ws.writeUTF(t),--o||i()})},o.prototype.onWsOpen=function(t){console.debug("onWsOpen"),r.prototype.onOpen.call(this)},o.prototype.onWsData=function(t){var e=this.ws.readUTF();r.prototype.onData.call(this,e)},o.prototype.onWsError=function(t){r.prototype.onError.call(this,t.data)},o.prototype.onWsClose=function(){r.prototype.onClose.call(this)},o.prototype.doOpen=function(){var e=this.uri();this.ws=new t.WebSocket,this.ws.type=t.WebSocket.TYPE_STRING,this.addEventListeners(),this.ws.connectByUrl(e)},o.prototype.doClose=function(){"undefined"!=typeof this.ws&&(this.ws.close(),this.ws=null)},o.prototype.uri=function(){var t=this.opts.clone();t.addTrailingSlash(),t.replaceQueryParam("b64",1);var e=t.secure?"wss":"ws";return t.protocol=e,t.timestampRequests&&t.addQueryParam(t.timestampParam,n.Yeast.yeast()),t.toString()},o.NAME="websocket",o}(n.Transport);n.WebSocket=r,__reflect(r.prototype,"egret.socketio.engine.WebSocket")}(n=e.engine||(e.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){function e(t){var e="";do e=r[t%length]+e,t=Math.floor(t/length);while(t>0);return e}function n(){var t=e((new Date).getDate());return t!==a?(s=0,a=t):t+"."+e(s++)}for(var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,i={},s=0,a="",c=0;o>c;c++)i[r[c]]=c;t.yeast=n}(e=t.Yeast||(t.Yeast={}))}(e=t.engine||(t.engine={}))}(e=t.socketio||(t.socketio={}))}(egret||(egret={}));